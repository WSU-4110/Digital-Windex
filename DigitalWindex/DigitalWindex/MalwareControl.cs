using System;
using System.Diagnostics;
using System.Drawing;
using System.IO;
using System.Windows.Forms;
using DigitalWindex.Backend;

namespace DesktopApp
{
    public partial class MalwareControl : UserControl
    {
        public MalwareControl()
        {
            InitializeComponent();
            this.Resize += new EventHandler(this.MalwareControl_Resize);
        }

        private void MalwareControl_Resize(object sender, EventArgs e)
        {
            int maxWidth = this.Width - 100;

            lblDescription.MaximumSize = new Size(maxWidth, 0);
            lblDescription.Left = (this.Width - lblDescription.Width) / 2;

            lblTitle.Left = (this.Width - lblTitle.Width) / 2;
            btnScanMalware.Left = (this.Width - btnScanMalware.Width) / 2;
        }

        private void BtnScanMalware_Click(object sender, EventArgs e)
        {
            string exePath = Path.Combine(Application.StartupPath, "McAfeeStingerPortable", "McAfeeStingerPortable.exe");
            if (!File.Exists(exePath))
            {
                MessageBox.Show("Scanner not found at:\n" + exePath, "Missing File", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                return;
            }

            try
            {
                LOG.WriteLog();
                ProcessStartInfo psi = new ProcessStartInfo
                {
                    FileName = exePath,
                    UseShellExecute = true,
                    Verb = "runas"
                };

                using (Process proc = Process.Start(psi))
                {
                    proc.WaitForExit();
                    MessageBox.Show("Scan completed. Exit Code: " + proc.ExitCode, "Done", MessageBoxButtons.OK, MessageBoxIcon.Information);
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show("Failed to launch scanner: " + ex.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }

        private void MalwareControl_Load(object sender, EventArgs e)
        {

        }
    }
}
