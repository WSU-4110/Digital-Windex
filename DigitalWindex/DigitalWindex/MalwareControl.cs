using System;
using System.Diagnostics;
using System.IO;
using System.Windows.Forms;

namespace DesktopApp
{
    public partial class MalwareControl : UserControl
    {
        public MalwareControl()
        {
            InitializeComponent();
        }

        private void MalwareControl_Load(object sender, EventArgs e)
        {
            // Additional initialization logic if needed
        }

        private void lblTitle_Click(object sender, EventArgs e)
        {
            // Handle title click if needed
        }

        private void lblDescription_Click(object sender, EventArgs e)
        {
            // Handle description click if needed
        }

        /// <summary>
        /// Handles the click event for scanning malware.
        /// Launches McAfee Stinger Portable from the subfolder "McAfeeStingerPortable".
        /// </summary>
        private void BtnScanMalware_Click(object sender, EventArgs e)
        {
            string stingerFolder = Path.Combine(Application.StartupPath, "McAfeeStingerPortable");
            string stingerPath = Path.Combine(stingerFolder, "McAfeeStingerPortable.exe");

            if (!File.Exists(stingerPath))
            {
                MessageBox.Show("McAfee Stinger Portable not found at: " + stingerPath,
                                "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            try
            {
                ProcessStartInfo psi = new ProcessStartInfo
                {
                    FileName = stingerPath,
                    Arguments = "", 
                    UseShellExecute = true,
                    Verb = "runas" 
                };

                using (Process proc = Process.Start(psi))
                {
                    proc.WaitForExit();
                    int exitCode = proc.ExitCode;

                    if (exitCode != 0)
                    {
                        MessageBox.Show("McAfee Stinger scan encountered issues. Exit Code: " + exitCode,
                                        "Scan Warning", MessageBoxButtons.OK, MessageBoxIcon.Warning);
                    }
                    else
                    {
                        MessageBox.Show("McAfee Stinger scan completed successfully.",
                                        "Scan Complete", MessageBoxButtons.OK, MessageBoxIcon.Information);
                    }
                }
            }
            catch (System.ComponentModel.Win32Exception ex)
            {
                if (ex.NativeErrorCode == 1223)
                {
                    MessageBox.Show("Scan canceled by user.", "Canceled",
                                    MessageBoxButtons.OK, MessageBoxIcon.Information);
                }
                else
                {
                    MessageBox.Show("Error running McAfee Stinger scan: " + ex.Message,
                                    "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }
        }
    }
}
